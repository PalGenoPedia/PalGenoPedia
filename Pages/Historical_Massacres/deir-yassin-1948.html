<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Loading...</title>
    <meta name="description" id="page-description" content="">
    <meta name="keywords" id="page-keywords" content="">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../../shared-styles.css">
    <link rel="stylesheet" href="../../unified-crisis-styles.css">
    <link rel="stylesheet" href="event-documentation-styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">
                <a href="../../index.html">Gaza Crisis Documentation</a>
            </h1>
            <nav class="nav">
                <a href="../../war-crimes-stats.html" class="nav-btn">‚öñÔ∏è War Crimes</a>
                <a href="../../hunger-crisis-stats.html" class="nav-btn">üçΩÔ∏è Hunger Crisis</a>
                <a href="../../major-incidents-timeline.html" class="nav-btn active">üìã Timeline</a>
            </nav>
            <button class="theme-toggle" aria-label="Toggle theme">üåô</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="event-documentation">
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb" id="breadcrumb-container"></div>

        <!-- Hero Section -->
        <div class="event-hero" id="hero-section"></div>

        <!-- Quick Info -->
        <div class="quick-info-box" id="quick-info"></div>

        <!-- Media Gallery Section -->
        <div id="media-gallery-section"></div>

        <!-- Executive Summary -->
        <section class="content-section" id="executive-summary"></section>

        <!-- Casualties Documentation -->
        <section class="content-section" id="casualties-section"></section>

        <!-- Timeline -->
        <section class="content-section" id="timeline-section"></section>

        <!-- Documented Atrocities -->
        <section class="content-section" id="war-crimes-section"></section>

        <!-- International Law -->
        <section class="content-section" id="international-law-section"></section>

        <!-- Witness Testimonies -->
        <section class="content-section" id="testimonies-section"></section>

        <!-- Historical Impact -->
        <section class="content-section" id="historical-impact-section"></section>

        <!-- Verified Sources -->
        <section class="content-section" id="sources-section"></section>

        <!-- Call to Action -->
        <div class="cta-section" id="cta-section"></div>
    </main>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="changeImage(-1)">&#10094;</button>
        <div class="lightbox-content">
            <img id="lightbox-image" class="lightbox-image" src="" alt="">
            <div id="lightbox-caption" class="lightbox-caption"></div>
        </div>
        <button class="lightbox-nav lightbox-next" onclick="changeImage(1)">&#10095;</button>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Main JavaScript -->
    <script>
        // ===================================================================
        // EVENT DOCUMENTATION PAGE JAVASCRIPT
        // Handles JSON data loading and rendering for historical massacres
        // Author: aliattia02
        // Last Updated: 2025-10-05 16:54:49 UTC
        // ===================================================================

        const jsonFilename = window.location.pathname.split('/').pop().replace('.html', '.json');
        let currentImageIndex = 0;
        let galleryImages = [];

        // ===================================================================
        // DATA LOADING
        // ===================================================================

        async function loadEventData() {
            try {
                const response = await fetch(jsonFilename);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                renderPage(data);
            } catch (error) {
                console.error('Error loading event data:', error);
                document.querySelector('.event-documentation').innerHTML = `
                    <div class="alert-box critical">
                        <span class="alert-icon">‚ö†Ô∏è</span>
                        <strong>Error:</strong> Unable to load event data. Please check that ${jsonFilename} exists.
                    </div>
                `;
            }
        }

        // ===================================================================
        // MAIN RENDER FUNCTION
        // ===================================================================

        function renderPage(data) {
            document.getElementById('page-title').textContent = data.metadata.pageTitle;
            document.getElementById('page-description').setAttribute('content', data.metadata.description);
            document.getElementById('page-keywords').setAttribute('content', data.metadata.keywords);

            renderBreadcrumb(data.breadcrumb);
            renderHero(data.hero);
            renderQuickFacts(data.quickFacts);
            if (data.media) renderMediaGallery(data.media);
            renderExecutiveSummary(data.executiveSummary);
            renderCasualties(data.casualties);
            renderTimeline(data.timeline);
            renderWarCrimes(data.warCrimes);
            renderInternationalLaw(data.internationalLaw);
            renderTestimonies(data.testimonies);
            renderHistoricalImpact(data.historicalImpact);
            renderSources(data.sources);
            renderCTA(data.cta);
            initializeAnimations();
        }

        // ===================================================================
        // RENDER FUNCTIONS
        // ===================================================================

        function renderBreadcrumb(breadcrumb) {
            document.getElementById('breadcrumb-container').innerHTML = breadcrumb.items.map((item) =>
                item.link ? `<a href="${item.link}">${item.text}</a>` : `<span>${item.text}</span>`
            ).join('<span class="breadcrumb-separator">‚Üí</span>');
        }

function renderHero(hero) {
    // Filter out Coordinates from hero metaCards
    const fieldsToHide = ['Coordinates'];
    const filteredMetaCards = hero.metaCards.filter(card => !fieldsToHide.includes(card.label));

    document.getElementById('hero-section').innerHTML = `
        <div class="event-category">${hero.category}</div>
        <h1 class="event-title">${hero.title}</h1>
        <p class="event-subtitle">${hero.subtitle}</p>
        <div class="event-meta-grid">
            ${filteredMetaCards.map(card => `
                <div class="meta-card">
                    <div class="meta-label">${card.icon} ${card.label}</div>
                    <div class="meta-value">${card.value}</div>
                    ${card.detail ? `<div class="meta-detail">${card.detail}</div>` : ''}
                </div>
            `).join('')}
        </div>
    `;
}

        function renderQuickFacts(quickFacts) {
            // Filter out specific fields: Coordinates, Event ID, Injured
            const fieldsToHide = ['Coordinates', 'Event ID', 'Injured'];
            const filteredItems = quickFacts.items.filter(item => !fieldsToHide.includes(item.label));

            document.getElementById('quick-info').innerHTML = `
                <div class="quick-info-title">${quickFacts.title}</div>
                <div class="quick-info-grid">
                    ${filteredItems.map(item => `
                        <div class="quick-info-item">
                            <span class="info-label">${item.label}</span>
                            <span class="info-value">${item.value}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderMediaGallery(media) {
            const container = document.getElementById('media-gallery-section');

            // Combine local and remote images
            const localImages = media.images?.local || [];
            const remoteImages = media.images?.remote || [];
            const allImages = [
                ...localImages.map(img => ({ src: `images/${img}`, type: 'local', original: img })),
                ...remoteImages.map(img => ({ src: img, type: 'remote', original: img }))
            ];

            // Combine local and remote documents
            const localDocuments = media.documents?.local || [];
            const remoteDocuments = media.documents?.remote || [];
            const allDocuments = [
                ...localDocuments.map(doc => ({ src: `documents/${doc}`, type: 'local', original: doc })),
                ...remoteDocuments.map(doc => ({ src: doc, type: 'remote', original: doc }))
            ];

            const hasImages = allImages.length > 0;
            const hasDocuments = allDocuments.length > 0;

            if (!hasImages && !hasDocuments) {
                container.style.display = 'none';
                return;
            }

            // Prepare gallery images for lightbox
            if (hasImages) {
                galleryImages = allImages.map(img => ({
                    src: img.src,
                    caption: img.original.replace(/\.[^/.]+$/, "").replace(/-/g, ' ').replace(/_/g, ' ').split('/').pop(),
                    type: img.type
                }));
            }

            let html = `
                <div class="media-gallery-section">
                    <div class="media-gallery-header">
                        <span style="font-size: 1.5rem;">üì∏</span>
                        <h2>Media & Documentation</h2>
                    </div>
            `;

            if (hasImages && hasDocuments) {
                html += `
                    <div class="media-tabs">
                        <button class="media-tab active" onclick="switchMediaTab('images')">
                            üñºÔ∏è Images (${allImages.length})
                        </button>
                        <button class="media-tab" onclick="switchMediaTab('documents')">
                            üìÑ Documents (${allDocuments.length})
                        </button>
                    </div>
                `;
            }

            if (hasImages) {
                html += `
                    <div id="media-images" class="media-content active">
                        <div class="image-gallery">
                            ${allImages.map((image, index) => {
                                const imgName = image.original.replace(/\.[^/.]+$/, "").replace(/-/g, ' ').replace(/_/g, ' ').split('/').pop();
                                const sourceLabel = image.type === 'remote' ? 'üåê External' : 'üìÅ Local';

                                return `
                                    <div class="gallery-item" onclick="openLightbox(${index})">
                                        <img src="${image.src}" alt="${imgName}" loading="lazy" onerror="this.parentElement.style.display='none';">
                                        <div class="gallery-item-overlay">
                                            <div>${imgName}</div>
                                            <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">${sourceLabel}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            if (hasDocuments) {
                html += `
                    <div id="media-documents" class="media-content ${!hasImages ? 'active' : ''}">
                        <div class="documents-list">
                            ${allDocuments.map(doc => {
                                const extension = doc.original.split('.').pop().toUpperCase();
                                const icon = getDocumentIcon(extension);
                                const name = doc.original.replace(/\.[^/.]+$/, "").replace(/-/g, ' ').replace(/_/g, ' ').split('/').pop();
                                const sourceLabel = doc.type === 'remote' ? 'üåê External Source' : 'üìÅ Local File';

                                return `
                                    <a href="${doc.src}" class="document-item" target="_blank" rel="noopener">
                                        <div class="document-icon">${icon}</div>
                                        <div class="document-info">
                                            <div class="document-name">${name}</div>
                                            <div class="document-type">${extension} Document ‚Ä¢ ${sourceLabel}</div>
                                        </div>
                                        <span style="font-size: 1.5rem;">‚¨áÔ∏è</span>
                                    </a>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            container.innerHTML = html;
        }

        function getDocumentIcon(extension) {
            const icons = {
                'PDF': 'üìï', 'DOC': 'üìò', 'DOCX': 'üìò', 'TXT': 'üìÑ',
                'XLS': 'üìó', 'XLSX': 'üìó', 'PPT': 'üìô', 'PPTX': 'üìô',
                'ZIP': 'üì¶', 'RAR': 'üì¶'
            };
            return icons[extension] || 'üìÑ';
        }

        function switchMediaTab(tab) {
            document.querySelectorAll('.media-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.media-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`media-${tab}`).classList.add('active');
        }

        function renderExecutiveSummary(summary) {
            document.getElementById('executive-summary').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${summary.icon}</span>
                    <h2 class="section-title">${summary.title}</h2>
                </div>
                <div class="section-content">
                    <div class="alert-box ${summary.alert.type}">
                        <span class="alert-icon">${summary.alert.icon}</span>
                        ${summary.alert.text}
                    </div>
                    ${summary.paragraphs.map(p => `<p>${p}</p>`).join('')}
                </div>
            `;
        }

        function renderCasualties(casualties) {
            document.getElementById('casualties-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${casualties.icon}</span>
                    <h2 class="section-title">${casualties.title}</h2>
                </div>
                <div class="section-content">
                    <div class="casualties-breakdown">
                        ${casualties.breakdown.map(item => `
                            <div class="casualty-card ${item.type}">
                                <div class="casualty-number">${item.number}</div>
                                <div class="casualty-label">${item.label}</div>
                                <div class="casualty-detail">${item.detail}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="alert-box ${casualties.alert.type}">
                        <span class="alert-icon">${casualties.alert.icon}</span>
                        ${casualties.alert.text}
                    </div>
                </div>
            `;
        }

        function renderTimeline(timeline) {
            document.getElementById('timeline-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${timeline.icon}</span>
                    <h2 class="section-title">${timeline.title}</h2>
                </div>
                <div class="section-content">
                    <div class="event-timeline">
                        ${timeline.events.map(event => `
                            <div class="timeline-item">
                                <div class="timeline-time">${event.time}</div>
                                <div class="timeline-content">
                                    <strong>${event.title}:</strong> ${event.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderWarCrimes(warCrimes) {
            document.getElementById('war-crimes-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${warCrimes.icon}</span>
                    <h2 class="section-title">${warCrimes.title}</h2>
                </div>
                <div class="section-content">
                    <div class="alert-box ${warCrimes.alert.type}">
                        <span class="alert-icon">${warCrimes.alert.icon}</span>
                        ${warCrimes.alert.text}
                    </div>
                    <ul class="war-crimes-list">
                        ${warCrimes.crimes.map(crime => `
                            <li>
                                <div class="war-crime-title">
                                    <span>${crime.icon}</span>
                                    ${crime.title}
                                </div>
                                <div class="war-crime-description">${crime.description}</div>
                                ${crime.sourceLink ? `
                                    <a href="${crime.sourceLink}" class="source-link" target="_blank" rel="noopener">
                                        ${crime.sourceText}
                                    </a>
                                ` : ''}
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
        }

        function renderInternationalLaw(law) {
            document.getElementById('international-law-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${law.icon}</span>
                    <h2 class="section-title">${law.title}</h2>
                </div>
                <div class="section-content">
                    <p>${law.introduction}</p>
                    ${law.sections.map(section => `
                        <h4>${section.heading}</h4>
                        <ul style="margin: 0.5rem 0 1rem 1.5rem; line-height: 1.7;">
                            ${section.violations.map(v => `<li>${v}</li>`).join('')}
                        </ul>
                    `).join('')}
                    <div class="alert-box ${law.alert.type}">
                        <span class="alert-icon">${law.alert.icon}</span>
                        ${law.alert.text}
                    </div>
                </div>
            `;
        }

        function renderTestimonies(testimonies) {
            document.getElementById('testimonies-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${testimonies.icon}</span>
                    <h2 class="section-title">${testimonies.title}</h2>
                </div>
                <div class="section-content">
                    <div class="alert-box ${testimonies.alert.type}">
                        <span class="alert-icon">${testimonies.alert.icon}</span>
                        ${testimonies.alert.text}
                    </div>
                    ${testimonies.witnesses.map(witness => `
                        <div class="testimony-card">
                            <div class="testimony-header">
                                <div class="witness-avatar">${witness.initials}</div>
                                <div class="witness-info">
                                    <div class="witness-name">${witness.name}</div>
                                    <div class="witness-role">${witness.role}</div>
                                </div>
                            </div>
                            <div class="testimony-text">"${witness.testimony}"</div>
                            <div class="testimony-source">
                                <strong>Source:</strong> ${witness.source}
                                ${witness.sourceLink ? `
                                    <a href="${witness.sourceLink}" class="source-link" target="_blank" rel="noopener">
                                        ${witness.sourceText}
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderHistoricalImpact(impact) {
            document.getElementById('historical-impact-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${impact.icon}</span>
                    <h2 class="section-title">${impact.title}</h2>
                </div>
                <div class="section-content">
                    ${impact.sections.map(section => `
                        <h3>${section.heading}</h3>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.7;">
                            ${section.items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    `).join('')}
                </div>
            `;
        }

        function renderSources(sources) {
            document.getElementById('sources-section').innerHTML = `
                <div class="section-header">
                    <span class="section-icon">${sources.icon}</span>
                    <h2 class="section-title">${sources.title}</h2>
                </div>
                <div class="section-content">
                    <p style="margin-bottom: 1rem; font-size: 0.9rem;">${sources.introduction}</p>
                    <div class="sources-compact">
                        ${sources.list.map(source => `
                            <div class="source-item-compact">
                                <div class="source-header-compact">
                                    <div class="source-icon-compact">${source.icon}</div>
                                    <div>
                                        <div class="source-name-compact">${source.name}</div>
                                        <div class="source-type-compact">${source.type}</div>
                                    </div>
                                </div>
                                <div class="source-description-compact">${source.description}</div>
                                ${source.link ? `
                                    <a href="${source.link}" class="source-link" target="_blank" rel="noopener">
                                        ${source.linkText}
                                    </a>
                                ` : ''}
                                ${source.verified ? '<span class="source-verification">‚úÖ Verified</span>' : ''}
                            </div>
                        `).join('')}
                    </div>
                    <div class="alert-box ${sources.alert.type}" style="margin-top: 1.5rem;">
                        <span class="alert-icon">${sources.alert.icon}</span>
                        ${sources.alert.text}
                    </div>
                </div>
            `;
        }

        function renderCTA(cta) {
            document.getElementById('cta-section').innerHTML = `
                <h2 class="cta-title">${cta.title}</h2>
                <p class="cta-description">${cta.description}</p>
                <div class="cta-buttons">
                    ${cta.buttons.map(button => `
                        <a href="${button.link}"
                           class="cta-btn ${button.type === 'secondary' ? 'secondary' : ''}"
                           ${button.action === 'print' ? 'onclick="window.print(); return false;"' : ''}
                           ${button.link.startsWith('http') || button.link.startsWith('mailto') ? 'target="_blank" rel="noopener"' : ''}>
                            ${button.text}
                        </a>
                    `).join('')}
                </div>
            `;
        }

        // ===================================================================
        // LIGHTBOX FUNCTIONS
        // ===================================================================

        function openLightbox(index) {
            currentImageIndex = index;
            const lightbox = document.getElementById('lightbox');
            document.getElementById('lightbox-image').src = galleryImages[index].src;
            document.getElementById('lightbox-caption').textContent = galleryImages[index].caption;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function changeImage(direction) {
            currentImageIndex += direction;
            if (currentImageIndex < 0) currentImageIndex = galleryImages.length - 1;
            else if (currentImageIndex >= galleryImages.length) currentImageIndex = 0;

            document.getElementById('lightbox-image').src = galleryImages[currentImageIndex].src;
            document.getElementById('lightbox-caption').textContent = galleryImages[currentImageIndex].caption;
        }

        // ===================================================================
        // ANIMATIONS
        // ===================================================================

        function initializeAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

            document.querySelectorAll('.content-section').forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(section);
            });
        }

        // ===================================================================
        // THEME MANAGEMENT
        // ===================================================================

        function initializeTheme() {
            const savedTheme = localStorage.getItem('gaza-docs-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function updateThemeIcon(theme) {
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // ===================================================================
        // EVENT LISTENERS
        // ===================================================================

        // Theme toggle
        document.querySelector('.theme-toggle')?.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('gaza-docs-theme', newTheme);
            updateThemeIcon(newTheme);
        });

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeLightbox();
            else if (e.key === 'ArrowLeft') changeImage(-1);
            else if (e.key === 'ArrowRight') changeImage(1);
        });

        // Smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // ===================================================================
        // INITIALIZATION
        // ===================================================================

        // Load footer
        fetch('../../common-styles.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('footer-placeholder').innerHTML = html;
            })
            .catch(error => console.error('Error loading footer:', error));

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadEventData();
            console.log('‚úÖ Event documentation page initialized - 2025-10-05 16:54:49 UTC');
        });
    </script>
</body>
</html>
