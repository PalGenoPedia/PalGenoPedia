<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="index.pageTitle">Gaza Crisis Documentation</title>
    <meta name="description" data-i18n="index.metaDescription" content="Comprehensive documentation of war crimes, hunger crisis, and humanitarian violations in Gaza">

    <!-- Main Styles -->
    <link rel="stylesheet" href="shared-styles.css">

    <style>
        /* ===== PAGE-SPECIFIC STYLES ===== */

        /* FIXED: Consistent banner heights and text handling */
        .crisis-banner {
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 20px 20px;
            position: relative;
            overflow: hidden;
            min-height: 160px;
            max-height: 180px;
        }

        .banner-content {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 2rem;
            align-items: center;
            position: relative;
            z-index: 1;
            height: 100%;
        }

        .banner-text {
            flex: 1;
            max-width: 400px;
        }

        .banner-text h3 {
            margin: 0 0 0.5rem 0;
            font-weight: 700;
            line-height: 1.2;
            font-size: 1.5rem;
        }

        .banner-text p {
            margin: 0;
            opacity: 0.9;
            line-height: 1.4;
            font-size: 0.95rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .banner-stats {
            display: flex;
            gap: 1.5rem;
            flex-shrink: 0;
        }

        .quick-stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 110px;
            max-width: 120px;
        }

        .stat-value {
            display: block;
            font-size: 1.6rem;
            font-weight: 900;
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .stat-label {
            display: block;
            font-size: 0.75rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            line-height: 1.1;
        }

        .banner-action {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .stats-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            padding: 0.9rem 1.8rem;
            border-radius: 25px;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition-base);
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .stats-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Data loading indicators */
        .data-loading-indicator {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
            animation: pulse 2s infinite;
        }

        .data-source-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.8);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-top: 0.5rem;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .crisis-banner .data-loading-indicator,
        .crisis-banner .data-source-badge {
            display: none;
        }

        /* Data loading status */
        .data-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            text-align: center;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-progress {
            margin-top: 20px;
            padding: 15px;
            background: var(--light-color);
            border-radius: 6px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Mobile responsiveness for banners */
        @media (max-width: 768px) {
            .crisis-banner {
                min-height: auto;
                max-height: none;
                padding: 1.5rem 0;
            }

            .banner-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1.5rem;
            }

            .banner-text {
                max-width: none;
            }

            .banner-text p {
                -webkit-line-clamp: 2;
            }

            .banner-stats {
                justify-content: center;
                flex-wrap: wrap;
                gap: 1rem;
            }

            .quick-stat {
                min-width: 90px;
                padding: 0.75rem;
            }

            .stat-value {
                font-size: 1.4rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }
        }

        @media (max-width: 480px) {
            .banner-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }

            .quick-stat {
                min-width: 80px;
                padding: 0.5rem;
            }

            .stat-value {
                font-size: 1.2rem;
            }

            .stats-btn {
                padding: 0.75rem 1.5rem;
                font-size: 0.85rem;
            }
        }

        /* ===== TIMELINE STYLES ===== */

        /* Timeline Statistics Dashboard */
        .timeline-stats-dashboard {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .stat-card {
            background: var(--surface-color);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .stat-sublabel {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Period Comparison */
        .period-comparison {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .comparison-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .comparison-card {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent-color);
            padding: 1rem;
            border-radius: var(--border-radius-sm);
        }

        .comparison-card.historical {
            border-left-color: #6c757d;
        }

        .comparison-card.current {
            border-left-color: #dc3545;
        }

        .comparison-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .comparison-stats {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .comparison-stat {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .comparison-stat strong {
            color: var(--text-primary);
        }

        /* Event Type Legend */
        .event-type-legend {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .legend-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: var(--shadow-sm);
        }

        /* Data Source Badge */
        .data-source-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(13, 110, 253, 0.1);
            color: #0d6efd;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px solid rgba(13, 110, 253, 0.3);
        }

        /* Advanced Filters */
        .advanced-filters {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .casualty-scale-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .scale-chip {
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .scale-chip:hover {
            border-color: var(--secondary-color);
        }

        .scale-chip.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        /* Timeline Loading */
        .timeline-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            text-align: center;
        }

        .loading-message {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .loading-detail {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Timeline Container */
        .timeline-container {
            width: 100%;
            margin-top: 2rem;
        }

        .timeline {
            width: 100%;
            min-height: 600px;
        }

        /* Timeline Header */
        .timeline-header-section {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .timeline-header-section h2 {
            color: var(--text-primary);
            font-size: 1.8rem;
            margin: 0 0 0.5rem 0;
            font-weight: 700;
        }

        .timeline-header-section p {
            color: var(--text-secondary);
            font-size: 1rem;
            margin: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body data-i18n-page-title="index.pageTitle" data-i18n-meta-desc="index.metaDescription">
    <!-- API Status Indicator -->
    <div id="apiStatus" class="api-status loading" data-i18n="index.apiStatus.loading">Loading...</div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">
                <a href="index.html" data-i18n="common.siteTitle">Gaza Crisis Documentation</a>
            </h1>
            <nav class="nav">
                <a href="war-crimes-stats.html" class="nav-btn" data-i18n="common.nav.warCrimes">‚öñÔ∏è War Crimes</a>
                <a href="hunger-crisis-stats.html" class="nav-btn" data-i18n="common.nav.hungerCrisis">üçΩÔ∏è Hunger Crisis</a>
                <a href="major-incidents-timeline.html" class="nav-btn" data-i18n="common.nav.timeline">üìã Timeline</a>
                <a href="http://localhost:5000" class="nav-btn tool-btn" data-i18n="common.nav.extractTool">üîç Extract Incidents</a>
            </nav>

            <!-- Language Selector -->
            <div id="language-selector" class="language-selector">
                <!-- Will be populated by translation-system.js -->
            </div>

            <button class="theme-toggle" aria-label="Toggle theme">üåô</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Data Loading Status -->
        <div id="dataStatus" class="container" style="display: none;">
            <div class="data-status" id="dataStatusContent" data-i18n="index.dataStatus.loading">
                üìä Loading crisis data from Tech for Palestine API v3...
            </div>
        </div>

        <!-- War Crimes Banner -->
        <div class="crisis-banner war-crimes-banner" id="warCrimesBanner">
            <div class="container">
                <div class="banner-content">
                    <div class="banner-text">
                        <h3 data-i18n="index.warCrimes.title">‚öñÔ∏è War Crimes & International Law Violations</h3>
                        <p data-i18n="index.warCrimes.description">Comprehensive documentation of systematic violations including attacks on civilians, medical facilities, and protected sites.</p>
                    </div>
                    <div class="banner-stats">
                        <div class="quick-stat">
                            <span class="stat-value" id="childrenKilledStat">Loading...</span>
                            <span class="stat-label" data-i18n="common.stats.childrenKilled">Children Killed</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="journalistsKilledStat">Loading...</span>
                            <span class="stat-label" data-i18n="common.stats.journalistsKilled">Journalists Killed</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="medicalStaffKilledStat">Loading...</span>
                            <span class="stat-label" data-i18n="common.stats.medicalStaffKilled">Medical Staff Killed</span>
                        </div>
                    </div>
                    <div class="banner-action">
                        <a href="war-crimes-stats.html" class="stats-btn" data-i18n="index.warCrimes.viewStats">
                            View Full Statistics ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hunger Crisis Banner -->
        <div class="crisis-banner hunger-crisis-banner" id="hungerCrisisBanner">
            <div class="container">
                <div class="banner-content">
                    <div class="banner-text">
                        <h3 data-i18n="index.hungerCrisis.title">üçΩÔ∏è Hunger Crisis & Starvation as Weapon of War</h3>
                        <p data-i18n="index.hungerCrisis.description">Documentation of systematic starvation tactics, aid blockades, and humanitarian catastrophe affecting 2.3 million people.</p>
                    </div>
                    <div class="banner-stats">
                        <div class="quick-stat">
                            <span class="stat-value" id="totalStarvationDeathsStat">Loading...</span>
                            <span class="stat-label" data-i18n="index.hungerCrisis.starvationDeaths">Total Deaths from Starvation</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="peopleInFamineStat">Loading...</span>
                            <span class="stat-label" data-i18n="index.hungerCrisis.famineConditions">People in Famine Conditions</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="totalAffectedPopulationStat">Loading...</span>
                            <span class="stat-label" data-i18n="index.hungerCrisis.totalAffected">Total Affected by Starvation</span>
                        </div>
                    </div>
                    <div class="banner-action">
                        <a href="hunger-crisis-stats.html" class="stats-btn" data-i18n="index.hungerCrisis.viewStats">
                            View Hunger Statistics ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Major Incidents Banner -->
        <div class="crisis-banner major-incidents-banner" id="majorIncidentsBanner">
            <div class="container">
                <div class="banner-content">
                    <div class="banner-text">
                        <h3 data-i18n="index.timeline.title">üìã Complete Historical Timeline (1948-Present)</h3>
                        <p data-i18n="index.timeline.description">Interactive documentation from the 1948 Nakba through current genocide. Verified sources from UN, Human Rights Watch, and international organizations.</p>
                    </div>
                    <div class="banner-stats">
                        <div class="quick-stat">
                            <span class="stat-value" id="totalIncidentsCount">27</span>
                            <span class="stat-label" data-i18n="index.timeline.totalEvents">Total Events</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="verifiedIncidentsCount">27</span>
                            <span class="stat-label" data-i18n="index.timeline.verifiedCases">Verified Cases</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="casualtiesCount">88K+</span>
                            <span class="stat-label" data-i18n="index.timeline.totalDeaths">Total Deaths</span>
                        </div>
                    </div>
                    <div class="banner-action">
                        <a href="major-incidents-timeline.html" class="stats-btn" data-i18n="index.timeline.viewTimeline">
                            View Detailed Timeline ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Section -->
        <div class="container">
            <!-- Timeline Header -->
            <div class="timeline-header-section">
                <h2 data-i18n="index.timelineSection.title">üìä Complete Historical Timeline (1948-Present)</h2>
                <p data-i18n="index.timelineSection.subtitle">27 major documented massacres and war crimes from the Nakba to current genocide</p>
                <span class="data-source-indicator">
                    <span data-i18n="index.timelineSection.sources">üîç Sources: UN, Human Rights Watch, B'Tselem, Al-Haq, PCHR</span>
                </span>
            </div>

            <!-- Statistics Dashboard -->
            <div class="timeline-stats-dashboard" id="statsDashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-number" id="massacresCount">27</div>
                        <div class="stat-label" data-i18n="index.stats.totalEvents">Total Events</div>
                        <div class="stat-sublabel" data-i18n="index.stats.documentedIncidents">Documented Incidents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíÄ</div>
                        <div class="stat-number" id="deathsCount">88K+</div>
                        <div class="stat-label" data-i18n="index.stats.totalDeaths">Total Deaths</div>
                        <div class="stat-sublabel" data-i18n="index.stats.verifiedCasualties">Verified Casualties</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè•</div>
                        <div class="stat-number" id="injuredCount">150K+</div>
                        <div class="stat-label" data-i18n="index.stats.injured">Injured</div>
                        <div class="stat-sublabel" data-i18n="index.stats.documentedInjuries">Documented Injuries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè†</div>
                        <div class="stat-number" id="displacedCount">2.3M</div>
                        <div class="stat-label" data-i18n="index.stats.displaced">Displaced</div>
                        <div class="stat-sublabel" data-i18n="index.stats.forcedDisplacement">Forced Displacement</div>
                    </div>
                </div>

                <!-- Period Comparison -->
                <div class="period-comparison" id="periodComparison">
                    <div class="comparison-header" data-i18n="index.comparison.header">
                        üìä Historical vs Current Comparison
                    </div>
                    <div class="comparison-grid">
                        <div class="comparison-card historical">
                            <div class="comparison-title" data-i18n="index.comparison.historicalTitle">üìú Historical Period (1948-2023)</div>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.duration">Duration:</span>
                                    <strong>75 years</strong>
                                </div>
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.majorEvents">Major Events:</span>
                                    <strong>17</strong>
                                </div>
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.totalDeaths">Total Deaths:</span>
                                    <strong>27,000+</strong>
                                </div>
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.avgDeathsYear">Avg Deaths/Year:</span>
                                    <strong>360</strong>
                                </div>
                            </div>
                        </div>
                        <div class="comparison-card current">
                            <div class="comparison-title" data-i18n="index.comparison.currentTitle">üö® Current Genocide (Oct 2023-Present)</div>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.duration">Duration:</span>
                                    <strong>12 months</strong>
                                </div>
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.majorEvents">Major Events:</span>
                                    <strong>10</strong>
                                </div>
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.totalDeaths">Total Deaths:</span>
                                    <strong>61,200+</strong>
                                </div>
                                <div class="comparison-stat">
                                    <span data-i18n="index.comparison.avgDeathsDay">Avg Deaths/Day:</span>
                                    <strong>167</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Event Type Legend -->
            <div class="event-type-legend">
                <div class="legend-title" data-i18n="index.legend.title">üìå Event Types</div>
                <div class="legend-items">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #dc3545;"></span>
                        <span data-i18n="index.legend.massacres">Massacres</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #fd7e14;"></span>
                        <span data-i18n="index.legend.militaryOperations">Military Operations</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #6f42c1;"></span>
                        <span data-i18n="index.legend.forcedDisplacement">Forced Displacement</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #e83e8c;"></span>
                        <span data-i18n="index.legend.hospitalAttacks">Hospital Attacks</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #6c757d;"></span>
                        <span data-i18n="index.legend.starvationWarfare">Starvation Warfare</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #0d6efd;"></span>
                        <span data-i18n="index.legend.protestSuppression">Protest Suppression</span>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-filters">
                <div class="filter-grid">
                    <!-- Date Range Filter -->
                    <div class="filter-group">
                        <label class="filter-label" data-i18n="index.filters.dateRange">üìÖ Date Range</label>
                        <select id="dateRangeFilter" class="filter-select">
                            <option value="" data-i18n="index.filters.allDates">All Dates (1948-Present)</option>
                            <option value="nakba" data-i18n="index.filters.nakba">Nakba (1948)</option>
                            <option value="first_intifada" data-i18n="index.filters.firstIntifada">First Intifada (1987-1993)</option>
                            <option value="second_intifada" data-i18n="index.filters.secondIntifada">Second Intifada (2000-2005)</option>
                            <option value="gaza_operations" data-i18n="index.filters.gazaOperations">Gaza Operations (2008-2021)</option>
                            <option value="current_genocide" data-i18n="index.filters.currentGenocide">Current Genocide (2023-Present)</option>
                        </select>
                    </div>

                    <!-- Event Type Filter -->
                    <div class="filter-group">
                        <label class="filter-label" data-i18n="index.filters.eventType">üè∑Ô∏è Event Type</label>
                        <select id="eventTypeFilter" class="filter-select">
                            <option value="" data-i18n="index.filters.allTypes">All Types</option>
                            <option value="massacre" data-i18n="index.filters.massacres">Massacres</option>
                            <option value="military_operation" data-i18n="index.filters.militaryOperations">Military Operations</option>
                            <option value="forced_displacement" data-i18n="index.filters.forcedDisplacement">Forced Displacement</option>
                            <option value="hospital_attack" data-i18n="index.filters.hospitalAttacks">Hospital Attacks</option>
                            <option value="protected_site_attack" data-i18n="index.filters.protectedSiteAttacks">Protected Site Attacks</option>
                            <option value="starvation_warfare" data-i18n="index.filters.starvationWarfare">Starvation Warfare</option>
                            <option value="protest_suppression" data-i18n="index.filters.protestSuppression">Protest Suppression</option>
                        </select>
                    </div>

                    <!-- Search Filter -->
                    <div class="filter-group">
                        <label class="filter-label" data-i18n="index.filters.search">üîç Search</label>
                        <input type="text" id="searchFilter" class="search-input" data-i18n-placeholder="index.filters.searchPlaceholder" placeholder="Search events, locations...">
                    </div>

                    <!-- Verification Status -->
                    <div class="filter-group">
                        <label class="filter-label" data-i18n="index.filters.verification">‚úÖ Verification</label>
                        <select id="verificationFilter" class="filter-select">
                            <option value="" data-i18n="index.filters.allStatuses">All Statuses</option>
                            <option value="verified" data-i18n="index.filters.verified">Verified</option>
                            <option value="disputed" data-i18n="index.filters.disputed">Disputed</option>
                            <option value="under_investigation" data-i18n="index.filters.underInvestigation">Under Investigation</option>
                        </select>
                    </div>
                </div>

                <!-- Casualty Scale Chips -->
                <div class="filter-group" style="margin-top: 1rem;">
                    <label class="filter-label" data-i18n="index.filters.casualtyScale">üìä Casualty Scale</label>
                    <div class="casualty-scale-filters">
                        <button class="scale-chip active" data-scale="all" data-i18n="index.filters.allScales">All Scales</button>
                        <button class="scale-chip" data-scale="low" data-i18n="index.filters.lowCasualties">1-50 casualties</button>
                        <button class="scale-chip" data-scale="medium" data-i18n="index.filters.mediumCasualties">51-500 casualties</button>
                        <button class="scale-chip" data-scale="high" data-i18n="index.filters.highCasualties">501-2000 casualties</button>
                        <button class="scale-chip" data-scale="massive" data-i18n="index.filters.massiveCasualties">2000+ casualties</button>
                    </div>
                </div>

                <div style="margin-top: 1rem; text-align: right;">
                    <button id="clearAllFilters" class="clear-btn" data-i18n="index.filters.clearAll">üîÑ Clear All Filters</button>
                </div>
            </div>

            <!-- Loading Status -->
            <div id="timelineStatus" class="container" style="display: none;">
                <div class="csv-status" id="timelineStatusContent" data-i18n="index.timelineStatus.loading">
                    üìä Loading timeline data...
                </div>
            </div>

            <!-- Timeline View -->
            <div class="timeline-container">
                <div id="timeline-embed" class="timeline">
                    <div class="timeline-loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-message" data-i18n="index.timelineLoading.message">Loading Complete Historical Timeline...</div>
                        <div class="loading-detail" data-i18n="index.timelineLoading.detail">Fetching data from 1948 to present...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Incident Detail Modal -->
    <div class="modal" id="incidentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle" data-i18n="index.modal.title">Event Details</h2>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="incident-details">
                    <div class="detail-section">
                        <h4 data-i18n="index.modal.basicInfo">üìã Basic Information</h4>
                        <div class="detail-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="detail-item">
                                <strong data-i18n="index.modal.date">üìÖ Date:</strong> <span id="modalDate"></span>
                            </div>
                            <div class="detail-item">
                                <strong data-i18n="index.modal.location">üìç Location:</strong> <span id="modalLocation"></span>
                            </div>
                            <div class="detail-item">
                                <strong data-i18n="index.modal.eventType">üè∑Ô∏è Event Type:</strong> <span id="modalType"></span>
                            </div>
                            <div class="detail-item">
                                <strong data-i18n="index.modal.verification">‚úÖ Verification:</strong> <span id="modalVerification"></span>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4 data-i18n="index.modal.summary">üìÑ Summary</h4>
                        <p id="modalSummary"></p>
                    </div>

                    <div class="detail-section" id="modalCasualtiesSection">
                        <h4 data-i18n="index.modal.casualties">üí• Casualties & Impact</h4>
                        <div id="modalCasualties" class="casualties-display"></div>
                    </div>

                    <div class="detail-section" id="modalWarCrimesSection">
                        <h4 data-i18n="index.modal.warCrimes">‚öñÔ∏è War Crimes Documented</h4>
                        <div id="modalWarCrimes" class="war-crimes-list"></div>
                    </div>

                    <div class="detail-section">
                        <h4 data-i18n="index.modal.sources">üì∞ Verified Sources</h4>
                        <div id="modalSources" class="sources-container"></div>
                    </div>

                    <div class="detail-section">
                        <div class="modal-actions">
                            <a id="modalDetailPage" href="#" class="detail-page-btn" target="_blank" style="display: inline-block; background: var(--secondary-color); color: white; padding: 0.75rem 1.5rem; border-radius: var(--border-radius); text-decoration: none; transition: var(--transition-base);" data-i18n="index.modal.viewFull">
                                üìñ View Full Documentation ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Styles -->
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: var(--border-radius-lg);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            margin: 0;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition-base);
        }

        .modal-close:hover {
            color: var(--accent-color);
        }

        .modal-body {
            padding: 2rem;
        }

        .detail-section {
            margin-bottom: 2rem;
        }

        .detail-section h4 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .detail-item {
            font-size: 0.9rem;
        }

        .detail-item strong {
            color: var(--text-primary);
        }

        .detail-page-btn:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: 1fr !important;
            }
        }
    </style>

    <!-- Translation System Script -->
    <script src="js/translation-system.js"></script>

    <!-- Universal Footer Component -->
    <div id="footer-placeholder"></div>
    <script>
        fetch('common-styles.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('footer-placeholder').innerHTML = html;

                // Initialize translation system after footer loads
                if (window.TranslationSystem && typeof window.TranslationSystem.init === 'function') {
                    window.TranslationSystem.init();
                }
            })
            .catch(error => {
                console.error('Error loading footer:', error);
                document.getElementById('footer-placeholder').innerHTML = `
                    <footer class="universal-footer">
                        <div class="footer-container">
                            <div class="footer-bottom">
                                <div class="footer-copyright" data-i18n="common.footer.copyright">
                                    ¬© 2024 Gaza Crisis Documentation Platform. All rights reserved.
                                </div>
                                <div class="footer-meta">
                                    <span class="footer-update-time">Last Updated: October 11, 2025</span>
                                </div>
                            </div>
                        </div>
                    </footer>
                `;
            });
    </script>

    <!-- External JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Main Application Script -->
    <script>
        console.log('üîß Initializing main index page with Complete Historical Timeline (1948-Present)...');

        // Initialize global variables
        window.incidents = [];
        window.filteredIncidents = [];
        window.dataLoaded = false;
        window.apiData = null;
        let lastUpdated = null;
        let isUsingFallback = false;

        // Hunger Crisis CSV Data
        let childrenStarvationStats = [];
        let totalPopulationStats = [];
        let hungerReferences = [];

        // Data mapping configuration for API v3 structure
        const dataMapping = {
            casualties: [
                {
                    icon: "üë∂",
                    label: "Children Killed",
                    apiKeys: ["gaza.killed.children"],
                    fallbackValue: 19000,
                    severity: "critical"
                },
                {
                    icon: "üì∞",
                    label: "Journalists Killed",
                    apiKeys: ["gaza.killed.press"],
                    fallbackValue: 140,
                    severity: "urgent"
                },
                {
                    icon: "üè•",
                    label: "Medical Personnel Killed",
                    apiKeys: ["gaza.killed.medical"],
                    fallbackValue: 1590,
                    severity: "warning"
                }
            ]
        };

        // CSV Data Loading Functions for Hunger Statistics
        async function loadHungerCSVData() {
            try {
                console.log('üìä Loading hunger crisis data from CSV files...');

                const childrenResponse = await fetch('children-starvation/children-starvation-statistics.csv');
                const childrenCSV = await childrenResponse.text();

                const totalPopResponse = await fetch('total-population/total-population-statistics.csv');
                const totalPopCSV = await totalPopResponse.text();

                const referencesResponse = await fetch('children-starvation/references.csv');
                const referencesCSV = await referencesResponse.text();

                childrenStarvationStats = await parseCSV(childrenCSV);
                totalPopulationStats = await parseCSV(totalPopCSV);
                hungerReferences = await parseCSV(referencesCSV);

                console.log(`‚úÖ Loaded ${childrenStarvationStats.length} children stats, ${totalPopulationStats.length} total population stats`);

                updateHungerBannerStats();
                return true;
            } catch (error) {
                console.error('‚ùå Error loading hunger CSV data:', error);
                loadFallbackHungerData();
                return false;
            }
        }

        function parseCSV(csvText) {
            return new Promise((resolve, reject) => {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    transformHeader: header => header.trim(),
                    transform: value => value.trim(),
                    complete: function(results) {
                        resolve(results.data);
                    },
                    error: function(error) {
                        reject(error);
                    }
                });
            });
        }

        function getHungerStatistic(statId, dataset = 'combined') {
            if (dataset === 'children' || dataset === 'combined') {
                const childStat = childrenStarvationStats.find(stat => stat.id == statId);
                if (childStat) return childStat;
            }

            if (dataset === 'total' || dataset === 'combined') {
                const totalStat = totalPopulationStats.find(stat => stat.id == statId);
                if (totalStat) return totalStat;
            }

            return null;
        }

        function updateHungerBannerStats() {
            try {
                console.log('üìä Updating hunger banner with CSV data...');

                const childrenDeaths = getHungerStatistic(1, 'children');
                const totalDeaths = getHungerStatistic(1, 'total');

                let totalStarvationDeaths = 0;
                if (childrenDeaths && childrenDeaths.value) {
                    totalStarvationDeaths += parseInt(childrenDeaths.value);
                }
                if (totalDeaths && totalDeaths.value) {
                    totalStarvationDeaths += parseInt(totalDeaths.value);
                }

                const peopleInFamine = getHungerStatistic(3, 'total');
                const totalAffected = getHungerStatistic(2, 'total');

                const totalStarvationEl = document.getElementById('totalStarvationDeathsStat');
                const peopleInFamineEl = document.getElementById('peopleInFamineStat');
                const totalAffectedEl = document.getElementById('totalAffectedPopulationStat');

                if (totalStarvationEl) {
                    totalStarvationEl.textContent = totalStarvationDeaths > 0 ? totalStarvationDeaths.toLocaleString() : '169+';
                }

                if (peopleInFamineEl) {
                    if (peopleInFamine && peopleInFamine.value) {
                        const value = parseInt(peopleInFamine.value);
                        peopleInFamineEl.textContent = value >= 1000 ? (value / 1000).toFixed(0) + 'K' : value.toLocaleString();
                    } else {
                        peopleInFamineEl.textContent = '500K';
                    }
                }

                if (totalAffectedEl) {
                    if (totalAffected && totalAffected.value) {
                        const value = parseInt(totalAffected.value);
                        totalAffectedEl.textContent = value >= 1000000 ? (value / 1000000).toFixed(1) + 'M' : value.toLocaleString();
                    } else {
                        totalAffectedEl.textContent = '2.1M';
                    }
                }

                console.log('‚úÖ Hunger banner stats updated successfully');

            } catch (error) {
                console.error('‚ùå Error updating hunger banner stats:', error);
                loadFallbackHungerData();
            }
        }

        function loadFallbackHungerData() {
            console.log('üìä Loading fallback hunger data...');

            const totalStarvationEl = document.getElementById('totalStarvationDeathsStat');
            const peopleInFamineEl = document.getElementById('peopleInFamineStat');
            const totalAffectedEl = document.getElementById('totalAffectedPopulationStat');

            if (totalStarvationEl) totalStarvationEl.textContent = '169+';
            if (peopleInFamineEl) peopleInFamineEl.textContent = '500K';
            if (totalAffectedEl) totalAffectedEl.textContent = '2.1M';
        }

        async function fetchApiData() {
            const apiUrl = 'https://data.techforpalestine.org/api/v3/summary.json';

            const proxyServices = [
                {
                    name: 'AllOrigins',
                    url: `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`,
                    parseResponse: (data) => JSON.parse(data.contents)
                }
            ];

            try {
                console.log('Attempting to fetch data from Tech for Palestine API v3...');
                updateApiStatus('loading', 'Loading API v3...');

                try {
                    const response = await fetch(apiUrl, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' },
                        mode: 'cors'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        window.apiData = data;
                        lastUpdated = data.gaza?.last_update || new Date().toISOString();
                        console.log('API v3 data fetched directly:', data);
                        updateApiStatus('live', 'Live Data');
                        isUsingFallback = false;
                        return data;
                    }
                } catch (directError) {
                    console.log('Direct fetch failed (expected due to CORS):', directError.message);
                }

                for (const proxy of proxyServices) {
                    try {
                        console.log(`Trying ${proxy.name} proxy...`);
                        updateApiStatus('loading', `Trying ${proxy.name}...`);

                        const proxyResponse = await fetch(proxy.url, {
                            method: 'GET',
                            headers: { 'Accept': 'application/json' }
                        });

                        if (proxyResponse.ok) {
                            const proxyData = await proxyResponse.json();
                            const data = proxy.parseResponse(proxyData);

                            if (data && data.gaza && data.gaza.killed) {
                                window.apiData = data;
                                lastUpdated = data.gaza?.last_update || new Date().toISOString();
                                console.log(`API v3 data fetched via ${proxy.name}:`, data);
                                updateApiStatus('live', `Live Data (${proxy.name})`);
                                isUsingFallback = false;
                                return data;
                            }
                        }
                    } catch (proxyError) {
                        console.log(`${proxy.name} proxy failed:`, proxyError.message);
                        continue;
                    }
                }

                throw new Error('All proxy methods failed');

            } catch (error) {
                console.error('All API fetch attempts failed:', error);
                throw error;
            }
        }

        function updateApiStatus(status, text) {
            const apiStatus = document.getElementById('apiStatus');
            if (apiStatus) {
                apiStatus.className = `api-status ${status}`;

                // Use translation if available
                if (window.TranslationSystem) {
                    const key = `index.apiStatus.${status}`;
                    const translation = window.TranslationSystem.getTranslation(key);
                    if (translation) {
                        apiStatus.textContent = translation;
                        return;
                    }
                }

                // Fallback if no translation available
                apiStatus.textContent = text;
            }
        }

        function getNestedValue(obj, path) {
            if (!obj || !path) return null;
            try {
                return path.split('.').reduce((current, key) => {
                    return current && typeof current === 'object' ? current[key] : null;
                }, obj);
            } catch (error) {
                console.warn(`Failed to get nested value for path: ${path}`, error);
                return null;
            }
        }

        function getValueFromData(data, config) {
            if (!data) return config.fallbackValue;

            for (const apiKey of config.apiKeys) {
                const value = getNestedValue(data, apiKey);
                if (value !== null && value !== undefined) {
                    return value;
                }
            }

            return config.fallbackValue;
        }

        function formatNumber(value) {
            if (value === null || value === undefined) return 'N/A';

            const num = parseInt(value);
            if (isNaN(num)) return 'N/A';

            // Use TranslationSystem's number formatter if available
            if (window.TranslationSystem && typeof window.TranslationSystem.formatNumber === 'function') {
                return window.TranslationSystem.formatNumber(num);
            }

            // Fallback formatting
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            } else {
                return num.toLocaleString();
            }
        }

        function showDataSuccess() {
            console.log('‚úÖ Data loaded successfully');
        }

        function showDataError(error) {
            console.error('Data Loading Error:', error);
        }

        async function loadMainPageData() {
            try {
                console.log('üìä Loading main page data from Tech for Palestine API v3 and CSV sources...');

                const [apiData, csvSuccess] = await Promise.all([
                    fetchApiData().catch(error => {
                        console.log('API fetch failed, continuing with CSV data only');
                        return null;
                    }),
                    loadHungerCSVData()
                ]);

                if (apiData && apiData.gaza) {
                    updateWarCrimesBannerStats(apiData);
                    console.log('‚úÖ API data loaded successfully');
                } else {
                    console.log('‚ö†Ô∏è Using fallback data for API-dependent stats');
                    loadFallbackData();
                }

                showDataSuccess();

                console.log('‚úÖ Main page data loaded successfully from combined sources');
                window.dataLoaded = true;
                return true;

            } catch (error) {
                console.error('Error loading main page data:', error);
                showDataError(error.message);
                loadFallbackData();
                loadFallbackHungerData();
                return false;
            }
        }

        function updateWarCrimesBannerStats(data) {
            try {
                console.log('üìä Updating war crimes banner stats with API data...');

                const childrenKilled = getValueFromData(data, dataMapping.casualties[0]);
                const journalistsKilled = getValueFromData(data, dataMapping.casualties[1]);
                const medicalStaffKilled = getValueFromData(data, dataMapping.casualties[2]);

                const childrenKilledEl = document.getElementById('childrenKilledStat');
                const journalistsKilledEl = document.getElementById('journalistsKilledStat');
                const medicalStaffKilledEl = document.getElementById('medicalStaffKilledStat');

                if (childrenKilledEl) childrenKilledEl.textContent = formatNumber(childrenKilled);
                if (journalistsKilledEl) journalistsKilledEl.textContent = formatNumber(journalistsKilled);
                if (medicalStaffKilledEl) medicalStaffKilledEl.textContent = formatNumber(medicalStaffKilled);

                console.log('‚úÖ War crimes banner stats updated successfully');

            } catch (error) {
                console.error('Error updating war crimes banner stats:', error);
                loadFallbackData();
            }
        }

        function loadFallbackData() {
            console.log('Loading fallback API data...');
            updateApiStatus('fallback', 'Cached Data');
            isUsingFallback = true;

            const childrenKilledEl = document.getElementById('childrenKilledStat');
            const journalistsKilledEl = document.getElementById('journalistsKilledStat');
            const medicalStaffKilledEl = document.getElementById('medicalStaffKilledStat');

            if (childrenKilledEl) childrenKilledEl.textContent = '19K';
            if (journalistsKilledEl) journalistsKilledEl.textContent = '140';
            if (medicalStaffKilledEl) medicalStaffKilledEl.textContent = '1.6K';

            console.log('Fallback API data loaded successfully');
        }

        async function initializeIndexPage() {
            console.log('üöÄ Index page initializing with Complete Historical Timeline (1948-Present)...');

            initializeTheme();

            try {
                await loadMainPageData();
                console.log('üìÖ Dual Timeline Manager will auto-initialize with Complete Timeline (1948-Present)...');
            } catch (error) {
                console.error('Failed to initialize page:', error);
                showDataError(error.message);
            }
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('gaza-docs-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);

            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('gaza-docs-theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
        }

        // Listen for language change events
        document.addEventListener('languageChanged', function(e) {
            console.log('üåê Language changed to:', e.detail.language, 'with direction:', e.detail.direction);

            // Update stats after language change to format numbers correctly
            if (window.apiData) {
                updateWarCrimesBannerStats(window.apiData);
            }
            updateHungerBannerStats();
        });

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeIndexPage);
        } else {
            initializeIndexPage();
        }
    </script>

    <!-- Custom Scripts - Use dual-timeline-manager.js -->
    <script src="dual-timeline-manager.js"></script>
</body>
</html>